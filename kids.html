<!DOCTYPE html>
<html>
<head>
    <title>Request Something</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#28a745">
    <link rel="manifest" href="kids.json">
    <style>
        body { font-family: sans-serif; padding: 40px 20px; text-align: center; background-color: #eef2f7; }
        .kid-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        h1 { color: #2b7de9; margin-bottom: 10px; }
        h3 { color: #666; margin-bottom: 20px; font-weight: normal; }
        input { width: 100%; padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; font-size: 1.2em; background: #28a745; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 20px; font-weight: bold; color: #2b7de9; min-height: 24px; }
        #setup-screen, #request-screen { display: none; }
    </style>
</head>
<body>
    <div class="kid-card">
        <div id="setup-screen">
            <h1>Welcome!</h1>
            <h3>Who is using this phone?</h3>
            <input type="text" id="user-name" placeholder="Enter your name">
            <button onclick="saveName()">Save & Start</button>
        </div>

        <div id="request-screen">
            <h1 id="greeting">Hi!</h1>
            <h3>What do you need?</h3>
            <input type="text" id="entry" placeholder="e.g. Apples" onkeydown="if(event.key === 'Enter') sendData()">
            <button onclick="sendData()">Send to Mom</button>
            <div id="status"></div>
            <p onclick="clearName()" style="margin-top:20px; color:#ccc; font-size:0.8em; cursor:pointer;">(Wrong name? Click here)</p>
        </div>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyH72NW-8mV1wZANz_DxJM5_nrA63fKRDBoVSPZ-HLAn73yx5cm-aFbHoaidxholMaq/exec"; 

        window.onload = function() {
            const savedName = localStorage.getItem('kidName');
            if (savedName) showRequestScreen(savedName);
            else document.getElementById('setup-screen').style.display = 'block';
        };

        function saveName() {
            const name = document.getElementById('user-name').value.trim();
            if (name) { localStorage.setItem('kidName', name); showRequestScreen(name); }
        }

        function showRequestScreen(name) {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('request-screen').style.display = 'block';
            document.getElementById('greeting').innerText = "Hi, " + name + "!";
        }

        function clearName() { localStorage.removeItem('kidName'); location.reload(); }

        function toTitleCase(str) { return str.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '); }

        async function sendData() {
            const itemInput = document.getElementById('entry');
            const status = document.getElementById('status');
            const savedName = localStorage.getItem('kidName');
            if(!itemInput.value) return;

            status.innerText = "üöÄ Sending...";
            try {
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: "add", text: toTitleCase(savedName) + " " + toTitleCase(itemInput.value) })
                });
                status.innerText = "‚úÖ Sent to Mom!";
                itemInput.value = "";
                setTimeout(() => { status.innerText = ""; }, 3000);
            } catch (e) { status.innerText = "‚ùå Try again!"; }
        }
    </script>
</body>
</html>
